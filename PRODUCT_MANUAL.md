# Investment Masters Handbook (IMH) 产品说明书

IMH 是一套**“可审计的投资决策中间层（Decision Middleware）”**，面向基金、交易与投研系统提供三类核心能力：**市场状态识别（Regime Router）**、**风险护栏覆盖（Risk Overlay）**、以及**治理与叙事解释层（Governance Narrative）**。它不替代原有的策略信号，而是通过复现大师智慧，为系统增加一层“决策护栏”。

---

## 1. 核心定位：Fund Stack 中的 Policy Gate

IMH 的最佳角色是在“交易信号生成”与“执行”之间充当 **Policy Gate**。它将复杂的市场环境映射为确定性的风险指令。

### 决策流图
```text
          [ 用户提问 / 股票信息 / 市场特征 ]
                    |
                    v
    +--------------------------------+
    |    1. 意图路由 (Intention)      |
    |  - 关键词触发 / 场景映射规则     |
    |  - 题库匹配 (Quick Lookup)     |
    +----------------+---------------+
                     |
       +-------------+-------------+
       |             |             |
 [ 选股大师 ]   [ 宏观大师 ]   [ 趋势大师 ]
 (如：巴菲特)   (如：达利奥)   (如：帕利哈皮)
       |             |             |
       +-------------+-------------+
                     |
                     v
    +--------------------------------+
    |   2. 知识增强 (RAG / Rules)    |
    |  - 语义向量搜索 (ChromaDB)      |
    |  - 核心决策规则提取 (IF-THEN)   |
    |  - 大师原著文档片段 (Markdown)  |
    +----------------+---------------+
                     |
                     v
    +--------------------------------+
    |   3. 逻辑推理与溯源 (Evidence)   |
    |  - 标注引用片段编号 (Source ID) |
    |  - 风险护栏计算 (Risk Overlay)  |
    +----------------+---------------+
                     |
                     v
          [ 输出：可审计的决策护栏与建议 ]
```

---

## 2. 技术核心：为什么用 RAG 而不是直接大模型？

在投资决策这种“高容错率极低”的场景下，直接调用大模型（Parametric Memory）存在天然缺陷，而 RAG（Source Memory）提供了机构级的解决方案：

| 维度 | 直接大模型 (LLM Only) | IMH RAG 模式 |
| :--- | :--- | :--- |
| **事实准确性** | **存在幻觉**。模型可能记错大师的特定参数（如：误把巴菲特的 1.5x 记成 2x）。 | **零幻觉检索**。直接从原著片段和结构化规则库中提取原始证据。 |
| **可审计性** | **黑盒输出**。无法得知结论背后的真实出处，难以过合规审阅。 | **白盒溯源**。每一条建议都带有 `Source ID` 和 `Rule ID`，可追溯至具体页码/文档。 |
| **时效性/私有化** | **知识滞后**。模型训练于过去，无法快速集成刚加入的大师（如：特朗普、佩洛西）。 | **即时更新**。新增大师只需放入一个 Markdown 文件，系统秒级完成索引。 |
| **确定性** | **概率漂移**。同样的输入，结论可能每次都在变，不适合做 Policy Gate。 | **逻辑锚定**。基于 IF-THEN 确定性规则进行推理，确保风险护栏的一致性。 |

### 核心哲学：灯塔与火把
- **直接大模型**像是一场“全凭记忆的开卷考试”，虽然博学但容易张冠李戴。
- **IMH RAG** 则是“带着规则书去考场”，模型只负责理解题意并从书中寻找最精准的段落进行翻译和应用。

---

## 3. 三大核心能力

### A. Regime Router（市场状态识别 → 指令路由）
IMH 內建「问题类型 → 投资人框架」的路由设计。它能自动将市场观测转化为特定情境。
- **抽象路径**：`Market Observations → Scenario → Rule Hits → Risk Budget 指令`
- **优势**：本地化规则优先，无需昂贵的 LLM 预处理即可实现精准分流。

### B. Risk Overlay（不改信号，只改“你敢下多少”）
IMH 最安全的用法是**不干涉买/卖方向**，只决定风险乘数与护栏。
- **控制项**：`max_leverage` (最高杠杆)、`min_cash` (最低现金比例)、`max_invest` (单票上限)、`max_turnover` (换手率限制)、`max_corr` (相关性上限)。
- **逻辑**：将市场状态（如“狂热”或“流动性收紧”）映射为护栏乘数，实现“自动减速/加速”。

### C. Governance & Narrative（治理与解释层）
IMH 填补了量化团队最常缺少的“解释层”。
- **可审计**：输出结构化 JSON 给系统消费，并保留所有 Rule ID 溯源。
- **可叙事**：输出人类可读的“因为…所以…”Markdown，用于生成周报、路演稿或合规说明。

---

## 4. 技术视野：灯塔与火把

IMH 结合了**规则的确定性（灯塔）**与 **AI 的探索性（火把）**。

| 模式 | 组件 | 特点 | 适用场景 |
| :--- | :--- | :--- | :--- |
| **灯塔 (Lighthouse)** | Policy Gate / 规则索引 | 高确定性、毫秒级响应、完全可审计 | 风控护栏、核心仓位决策、本地部署 |
| **火把 (Torch)** | RAG / Agentic RAG | 覆盖长尾、支持追问、反例验证 | 深度研究、情境复盘、云端性能方案 |

### 局限性警示
- **RAG 的不足**：RAG 擅长局部检索，但不擅长“全局逻辑总结”。
- **进阶建议**：对于需要强结构关系、跨全文总结的任务，建议结合 **Long Context** 或 **GraphRAG** 使用。

---

## 5. 接入与部署

### 核心接口 (API)
- **Policy Gate**：`POST /api/policy/gate` —— 输入市场观测，输出风险护栏与审计证据。
- **Global RAG**：`POST /api/rag/query` —— 跨大师联合检索证据。
- **Quick Router**：`POST /api/route` —— 本地规则路由。

### 部署建议
- **本地优先**：为了数据隐私与低延迟，IMH 支持全本地运行（规则 + 向量库 + 轻量 Embedding）。
- **云端扩展**：对于更复杂的 Agentic 推理，可接入更高性能的云端大模型。

---

> **IMH：让算法拥有“大师级”的全局视野与风控自觉。**
